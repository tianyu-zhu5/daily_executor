# è‡ªåŠ¨åŒ–æ¨é€è„šæœ¬ - ä½¿ç”¨è¯´æ˜

æ¯ä¸ªäº¤æ˜“æ—¥è‡ªåŠ¨æ‰§è¡Œï¼šKçº¿æ•°æ®æ›´æ–° â†’ **CCIåº•èƒŒç¦»æ£€æµ‹** â†’ ä¿¡å·ç”Ÿæˆ â†’ å¾®ä¿¡æ¨é€

**æ–°å¢åŠŸèƒ½** â­: é›†æˆCCIåº•èƒŒç¦»è‡ªåŠ¨æ£€æµ‹ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°æ•°æ®åº“ï¼

---

## ç›®å½•ç»“æ„

```
daily_executor/
â”œâ”€â”€ config.json              # é…ç½®æ–‡ä»¶ï¼ˆå¿…é¡»é…ç½®ï¼‰
â”œâ”€â”€ daily_executor.py        # ä¸»æ‰§è¡Œè„šæœ¬
â”œâ”€â”€ wechat_pusher.py         # å¾®ä¿¡æ¨é€æ¨¡å—
â”œâ”€â”€ query_engine.py          # æŸ¥è¯¢å¼•æ“ï¼ˆæ–°å¢ï¼‰â­
â”œâ”€â”€ signal_types.py          # ä¿¡å·æ•°æ®ç±»å‹ï¼ˆæ–°å¢ï¼‰â­
â”œâ”€â”€ formatters.py            # è¾“å‡ºæ ¼å¼åŒ–å™¨ï¼ˆæ–°å¢ï¼‰â­
â”œâ”€â”€ add_database_indexes.py  # æ•°æ®åº“ç´¢å¼•å·¥å…·
â”œâ”€â”€ setup_task.bat           # Windowså®šæ—¶ä»»åŠ¡è®¾ç½®è„šæœ¬
â”œâ”€â”€ data/                    # æœ¬åœ°æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰â­
â”‚   â””â”€â”€ cci_signals.db       # CCIåº•èƒŒç¦»æ•°æ®åº“ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ signals/                 # ä¿¡å·è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â””â”€â”€ README.md                # æœ¬æ–‡ä»¶
```

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install requests pandas
```

### 2. é…ç½® Serveré…±

1. è®¿é—® [Serveré…±å®˜ç½‘](https://sct.ftqq.com/) æ³¨å†Œè´¦å·
2. è·å– SendKeyï¼ˆæ¯ä¸ªæ¥æ”¶äººéœ€è¦ä¸€ä¸ªSendKeyï¼‰
3. ç¼–è¾‘ `config.json`ï¼Œå¡«å…¥å®é™…çš„SendKey

```json
{
  "server_sauce": {
    "recipients": [
      {
        "name": "å¼ ä¸‰",
        "sendkey": "SCT123xxxè¯·æ›¿æ¢ä¸ºå®é™…çš„SendKey",
        "enabled": true
      }
    ]
  }
}
```

### 3. æµ‹è¯•è¿è¡Œ

```bash
cd daily_executor
python daily_executor.py
```

æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—ï¼š
- æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `logs/executor_YYYYMMDD_HHMMSS.log`
- æ£€æŸ¥æ¯ä¸ªæ­¥éª¤æ˜¯å¦æˆåŠŸ

### 4. è®¾ç½®å®šæ—¶ä»»åŠ¡

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰**

1. å³é”® `setup_task.bat`ï¼Œé€‰æ‹©"ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
2. æŒ‰æç¤ºç¡®è®¤åˆ›å»ºä»»åŠ¡
3. ä»»åŠ¡å°†åœ¨æ¯ä¸ªå·¥ä½œæ—¥16:00è‡ªåŠ¨æ‰§è¡Œ

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º**

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº" (Win+R â†’ `taskschd.msc`)
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è§¦å‘å™¨ï¼šæ¯å‘¨ï¼Œå‘¨ä¸€è‡³å‘¨äº”ï¼Œ16:00
4. æ“ä½œï¼šå¯åŠ¨ç¨‹åº `python` + å‚æ•° `daily_executor.py`
5. èµ·å§‹äºï¼š`C:\Users\Administrator\Documents\quant\daily_executor`

---

## æŸ¥è¯¢å†å²ä¿¡å· â­ æ–°åŠŸèƒ½

ä» v2.0.0 å¼€å§‹ï¼Œç³»ç»Ÿæ”¯æŒæŸ¥è¯¢å†å²äº¤æ˜“æ—¥çš„CCIåº•èƒŒç¦»ä¿¡å·ï¼Œæ— éœ€é‡æ–°è¿è¡Œæ•´ä¸ªæµç¨‹ã€‚

### åŸºæœ¬ç”¨æ³•

#### æŸ¥è¯¢å•ä¸ªæ—¥æœŸçš„ä¿¡å·
```bash
python daily_executor.py query --date 2025-09-04
```

#### æŸ¥è¯¢æ—¥æœŸèŒƒå›´çš„ä¿¡å·
```bash
python daily_executor.py query --date-range 2025-09-01 2025-09-10
```

#### æŒ‰ç½®ä¿¡åº¦è¿‡æ»¤
```bash
python daily_executor.py query --date 2025-09-04 --min-confidence 0.7
```

#### æŸ¥è¯¢ç‰¹å®šè‚¡ç¥¨
```bash
python daily_executor.py query --date 2025-09-04 --stock-code 600000_SH
```

### è¾“å‡ºæ ¼å¼

#### 1. æ§åˆ¶å°è¾“å‡ºï¼ˆé»˜è®¤ï¼‰
```bash
python daily_executor.py query --date 2025-09-04
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š æŸ¥è¯¢ç»“æœ

æŸ¥è¯¢å‚æ•°:
  æ—¥æœŸèŒƒå›´: 2025-09-04 è‡³ 2025-09-04
  è‚¡ç¥¨ä»£ç : å…¨éƒ¨
  æœ€å°ç½®ä¿¡åº¦: 0.5

ä¿¡å·ç»Ÿè®¡:
  ä¿¡å·æ€»æ•°: 12
  è‚¡ç¥¨æ•°é‡: 12
  å¹³å‡ç½®ä¿¡åº¦: 0.68

   stock_code  signal_date  confidence  entry_price  ...
0  600000_SH   2025-09-04   0.75        11.20        ...
1  000001_SZ   2025-09-04   0.62        15.30        ...
```

#### 2. CSV æ ¼å¼
```bash
python daily_executor.py query --date 2025-09-04 --output csv
```

ç”Ÿæˆæ–‡ä»¶ï¼š`signals/query_2025-09-04_<timestamp>.csv`

#### 3. JSON æ ¼å¼
```bash
python daily_executor.py query --date 2025-09-04 --output json
```

ç”Ÿæˆæ–‡ä»¶ï¼š`signals/query_2025-09-04_<timestamp>.json`

JSON ç»“æ„ï¼š
```json
{
  "query_info": {
    "start_date": "2025-09-04",
    "end_date": "2025-09-04",
    "stock_codes": null,
    "min_confidence": 0.5,
    "timestamp": "2025-11-11 14:30:00"
  },
  "statistics": {
    "total_signals": 12,
    "unique_stocks": 12,
    "date_range": "2025-09-04 è‡³ 2025-09-04",
    "avg_confidence": 0.68
  },
  "signals": [
    {
      "stock_code": "600000_SH",
      "signal_date": "2025-09-04",
      "confidence": 0.75,
      "entry_price": 11.20,
      "reason": "CCIåº•èƒŒç¦»(CCI:-120.5â†’-85.3, 5å¤©)",
      "divergence_id": "600000_SH_2025-09-04"
    }
  ]
}
```

#### 4. å¤šç§æ ¼å¼ç»„åˆ
```bash
python daily_executor.py query --date 2025-09-04 --output csv --output json
```

#### 5. æ¨é€åˆ°å¾®ä¿¡
```bash
python daily_executor.py query --date 2025-09-04 --push-wechat
```

### é«˜çº§æŸ¥è¯¢ç¤ºä¾‹

#### æŸ¥è¯¢é«˜ç½®ä¿¡åº¦ä¿¡å·å¹¶å¯¼å‡ºCSV
```bash
python daily_executor.py query --date-range 2025-09-01 2025-09-10 \
  --min-confidence 0.8 \
  --output csv
```

#### æŸ¥è¯¢ç‰¹å®šè‚¡ç¥¨å¹¶æ¨é€å¾®ä¿¡
```bash
python daily_executor.py query --date 2025-09-04 \
  --stock-code 600000_SH \
  --push-wechat
```

#### æŸ¥è¯¢å¹¶ç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼ˆæ‰€æœ‰æ ¼å¼ï¼‰
```bash
python daily_executor.py query --date-range 2025-09-01 2025-09-10 \
  --min-confidence 0.7 \
  --output console --output csv --output json \
  --push-wechat
```

### æ€§èƒ½ä¼˜åŒ–

æŸ¥è¯¢æ€§èƒ½å·²é€šè¿‡æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ï¼š

```bash
# é¦–æ¬¡ä½¿ç”¨å‰ï¼Œå»ºè®®æ·»åŠ ç´¢å¼•
python add_database_indexes.py ../CCI_Divergence/data/cci_signals.db
```

**ç´¢å¼•æ•ˆæœ**ï¼š
- æŸ¥è¯¢å•ä¸ªæ—¥æœŸï¼š< 0.5 ç§’
- æŸ¥è¯¢ 10 å¤©èŒƒå›´ï¼š< 1 ç§’
- æŸ¥è¯¢ 30 å¤©èŒƒå›´ï¼š< 2 ç§’

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### config.json å„å­—æ®µè¯´æ˜

#### 1. server_sauce - Serveré…±é…ç½®

```json
{
  "server_sauce": {
    "recipients": [
      {
        "name": "æ¥æ”¶äººå§“å",
        "sendkey": "Serveré…±SendKey",
        "enabled": true  // æ˜¯å¦å¯ç”¨æ­¤æ¥æ”¶äºº
      }
    ]
  }
}
```

- `name`: æ¥æ”¶äººå§“åï¼ˆç”¨äºæ—¥å¿—è¯†åˆ«ï¼‰
- `sendkey`: Serveré…±æä¾›çš„SendKey
- `enabled`: è®¾ç½®ä¸º `false` å¯ä¸´æ—¶ç¦ç”¨æŸä¸ªæ¥æ”¶äºº

#### 2. signal_generation - ä¿¡å·ç”Ÿæˆé…ç½®

```json
{
  "signal_generation": {
    "db_path": "../CCI-Divergence/data/cci_signals.db",  // CCIæ•°æ®åº“è·¯å¾„
    "data_dir": "../data/daily",                         // Kçº¿æ•°æ®ç›®å½•
    "stock_pool_file": "../CCI-Divergence/stock_pools/hs300.txt",  // è‚¡ç¥¨æ± æ–‡ä»¶
    "output_file": "./signals/daily_signals.csv",        // ä¿¡å·è¾“å‡ºæ–‡ä»¶
    "min_confidence": 0.6,                               // æœ€å°ç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰
    "use_next_day_open": true                            // æ˜¯å¦ä½¿ç”¨æ¬¡æ—¥å¼€ç›˜ä»·
  }
}
```

**åˆ‡æ¢è‚¡ç¥¨æ± ï¼š**
- æ²ªæ·±300: `../CCI-Divergence/stock_pools/hs300.txt`
- ä¸­è¯500: `../CCI-Divergence/stock_pools/zz500.txt` (å¦‚æœå­˜åœ¨)
- å…¨Aè‚¡: è®¾ç½®ä¸º `null` æˆ–åˆ é™¤ `stock_pool_file` å­—æ®µ

**è°ƒæ•´ç½®ä¿¡åº¦ï¼š**
- `0.0`: æ¨é€æ‰€æœ‰ä¿¡å·
- `0.5`: æ¨é€ä¸­ç­‰ç½®ä¿¡åº¦ä¿¡å·
- `0.7`: æ¨é€é«˜ç½®ä¿¡åº¦ä¿¡å·
- `0.9`: æ¨é€æé«˜ç½®ä¿¡åº¦ä¿¡å·

#### 3. cci_update - CCIåº•èƒŒç¦»æ›´æ–°é…ç½®

```json
{
  "cci_update": {
    "local_db_path": "./data/cci_signals.db",  // æœ¬åœ°CCIæ•°æ®åº“è·¯å¾„
    "data_dir": "../data/daily",               // Kçº¿æ•°æ®ç›®å½•
    "cci_period": 20,                          // CCIè®¡ç®—å‘¨æœŸ
    "pivot_window": 10,                        // è½¬æŠ˜ç‚¹è¯†åˆ«çª—å£
    "divergence_validity_days": 20,            // èƒŒç¦»æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰
    "timeout_seconds": 600                     // è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  }
}
```

**è¯´æ˜**ï¼š
- æ­¥éª¤1.5ä¼šåœ¨æœ¬åœ° `./data/cci_signals.db` ä¸­å­˜å‚¨CCIåº•èƒŒç¦»æ•°æ®
- åªå¤„ç†é…ç½®çš„è‚¡ç¥¨æ± å’ŒæŒ‡å®šæ—¥æœŸçš„æ•°æ®
- æ•°æ®ä¸ `CCI-Divergence` é¡¹ç›®ç‹¬ç«‹ï¼Œäº’ä¸å½±å“

#### 4. data_update - æ•°æ®æ›´æ–°é…ç½®

```json
{
  "data_update": {
    "script_path": "../data/stock_data_manager.py",  // æ•°æ®æ›´æ–°è„šæœ¬è·¯å¾„
    "timeout_seconds": 1800                          // è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  }
}
```

#### 5. filter_conditions - ä¿¡å·è¿‡æ»¤æ¡ä»¶

```json
{
  "filter_conditions": {
    "min_confidence": 0.6,         // æœ€å°ç½®ä¿¡åº¦ï¼ˆä¸signal_generationä¸€è‡´ï¼‰
    "max_signals_per_day": null,   // æ¯å¤©æœ€å¤šæ¨é€å¤šå°‘ä¸ªä¿¡å·ï¼ˆnull=ä¸é™åˆ¶ï¼‰
    "exclude_stocks": []            // æ’é™¤çš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
  }
}
```

ç¤ºä¾‹ - æ’é™¤ç‰¹å®šè‚¡ç¥¨ï¼š
```json
{
  "exclude_stocks": ["000001_SZ", "600519_SH"]
}
```

#### 6. push_settings - æ¨é€è®¾ç½®

```json
{
  "push_settings": {
    "include_stock_name": true,                  // æ˜¯å¦åŒ…å«è‚¡ç¥¨åç§°
    "stock_name_cache": "../data/stock_list.txt",  // è‚¡ç¥¨åç§°ç¼“å­˜æ–‡ä»¶
    "message_format": "markdown",                // æ¶ˆæ¯æ ¼å¼ï¼ˆmarkdownï¼‰
    "push_on_no_signals": false                  // æ— ä¿¡å·æ—¶æ˜¯å¦æ¨é€
  }
}
```

#### 7. logging - æ—¥å¿—é…ç½®

```json
{
  "logging": {
    "log_dir": "./logs",   // æ—¥å¿—ç›®å½•
    "log_level": "INFO",   // æ—¥å¿—çº§åˆ«ï¼šDEBUG, INFO, WARNING, ERROR
    "keep_days": 30        // æ—¥å¿—ä¿ç•™å¤©æ•°
  }
}
```

#### 8. execution - æ‰§è¡Œé…ç½®

```json
{
  "execution": {
    "stop_on_error": true,  // é‡åˆ°é”™è¯¯æ˜¯å¦åœæ­¢ï¼ˆtrue=ç«‹å³åœæ­¢ï¼‰
    "retry_count": 0        // å¤±è´¥é‡è¯•æ¬¡æ•°ï¼ˆ0=ä¸é‡è¯•ï¼‰
  }
}
```

---

## æ‰§è¡Œæµç¨‹

ç³»ç»Ÿæ”¯æŒä¸¤ç§æ‰§è¡Œæ¨¡å¼ï¼š

### æ¨¡å¼ 1ï¼šæ—¥å¸¸è‡ªåŠ¨åŒ–æ‰§è¡Œï¼ˆrun å‘½ä»¤ï¼‰

**ç”¨é€”**ï¼šæ¯ä¸ªäº¤æ˜“æ—¥è‡ªåŠ¨æ‰§è¡Œå®Œæ•´æµç¨‹

**å‘½ä»¤**ï¼š
```bash
python daily_executor.py run
# æˆ–ç›´æ¥è¿è¡Œï¼ˆé»˜è®¤ä¸º run æ¨¡å¼ï¼‰
python daily_executor.py
```

**æµç¨‹**ï¼šæ­¥éª¤1ï¼ˆæ›´æ–°Kçº¿æ•°æ®ï¼‰â†’ æ­¥éª¤1.5ï¼ˆæ£€æµ‹CCIèƒŒç¦»ï¼‰â†’ æ­¥éª¤2ï¼ˆç”Ÿæˆä¿¡å·ï¼‰â†’ æ­¥éª¤3ï¼ˆæ¨é€å¾®ä¿¡ï¼‰

### æ¨¡å¼ 2ï¼šå†å²ä¿¡å·æŸ¥è¯¢ï¼ˆquery å‘½ä»¤ï¼‰

**ç”¨é€”**ï¼šæŸ¥è¯¢å†å²äº¤æ˜“æ—¥çš„ä¿¡å·ï¼Œæ— éœ€é‡æ–°è¿è¡Œæ•°æ®æ›´æ–°

**å‘½ä»¤**ï¼š
```bash
python daily_executor.py query --date 2025-09-04
```

**æµç¨‹**ï¼šç›´æ¥ä»æ•°æ®åº“æŸ¥è¯¢ â†’ æ ¼å¼åŒ–è¾“å‡º â†’ å¯é€‰æ¨é€å¾®ä¿¡

---

### æ­¥éª¤1: æ›´æ–°Kçº¿æ•°æ®ï¼ˆä»… run æ¨¡å¼ï¼‰
- è„šæœ¬ï¼š`../data/stock_data_manager.py`
- åŠŸèƒ½ï¼šé€šè¿‡miniQMTæ›´æ–°å½“å¤©çš„Kçº¿æ•°æ®
- è€—æ—¶ï¼šå¢é‡æ›´æ–°çº¦5-10åˆ†é’Ÿ
- å‚æ•°ï¼š`--skip-step1` è·³è¿‡æ­¤æ­¥éª¤

### æ­¥éª¤1.5: æ›´æ–°CCIåº•èƒŒç¦»æ•°æ®ï¼ˆæ–°å¢ï¼‰â­
- åŠŸèƒ½ï¼šæ£€æµ‹æŒ‡å®šæ—¥æœŸçš„CCIåº•èƒŒç¦»å¹¶ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
- æ•°æ®åº“ï¼š`./data/cci_signals.db`ï¼ˆæœ¬åœ°ç‹¬ç«‹æ•°æ®åº“ï¼‰
- å¤„ç†èŒƒå›´ï¼š
  - è‚¡ç¥¨æ± ï¼šä» `config.json` è¯»å–
  - æ—¥æœŸï¼šæŒ‡å®šæ—¥æœŸæˆ–ä»Šå¤©
- è€—æ—¶ï¼šæ²ªæ·±300çº¦1-3åˆ†é’Ÿ
- å‚æ•°ï¼š`--skip-step1.5` è·³è¿‡æ­¤æ­¥éª¤ï¼ˆä½¿ç”¨ç°æœ‰æ•°æ®åº“ï¼‰

**é‡è¦è¯´æ˜**ï¼š
- è¿™æ˜¯æ–°å¢æ­¥éª¤ï¼Œç¡®ä¿æœ¬åœ°æœ‰æœ€æ–°çš„CCIåº•èƒŒç¦»æ•°æ®
- ä¸ `CCI-Divergence` é¡¹ç›®çš„æ•°æ®åº“ç‹¬ç«‹ï¼Œä¸ä¼šç›¸äº’å½±å“
- åªå¤„ç†æŒ‡å®šæ—¥æœŸçš„è‚¡ç¥¨ï¼Œé¿å…é‡å¤è®¡ç®—

### æ­¥éª¤2: ç”Ÿæˆä¹°å…¥ä¿¡å·ï¼ˆrun å’Œ query æ¨¡å¼å…±ç”¨ï¼‰
- **æ¶æ„å‡çº§** â­: ä½¿ç”¨ `QueryEngine` ç»Ÿä¸€æŸ¥è¯¢é€»è¾‘
- åŠŸèƒ½ï¼šä»CCIæ•°æ®åº“æŸ¥è¯¢æœ‰æ•ˆçš„åº•èƒŒç¦»ä¿¡å·
- æ•°æ®æºï¼š`../CCI_Divergence/data/cci_signals.db` æˆ– `./data/cci_signals.db`
- æŸ¥è¯¢æ¡ä»¶ï¼š
  - `end_date` <= ç›®æ ‡æ—¥æœŸ <= `expiry_date`ï¼ˆèƒŒç¦»åœ¨æœ‰æ•ˆæœŸå†…ï¼‰
  - `stock_code` in è‚¡ç¥¨æ± ï¼ˆå¯é€‰ï¼‰
  - `confidence` >= æœ€å°ç½®ä¿¡åº¦
- **ä»£ç å¤ç”¨**: run æ¨¡å¼ä¸‹çš„æ¯æ—¥ä¿¡å·ç”Ÿæˆæœ¬è´¨ä¸Šæ˜¯ query æ¨¡å¼çš„ç‰¹ä¾‹ï¼ˆæŸ¥è¯¢æ—¥æœŸ = ä»Šå¤©ï¼‰

### æ­¥éª¤3: æ¨é€åˆ°å¾®ä¿¡
- æ¨¡å—ï¼š`wechat_pusher.py`
- åŠŸèƒ½ï¼šè¯»å–ä¿¡å·CSVï¼Œæ ¼å¼åŒ–æ¶ˆæ¯ï¼Œæ¨é€ç»™æ‰€æœ‰é…ç½®çš„æ¥æ”¶äºº
- æ¶ˆæ¯æ ¼å¼ï¼š
  ```
  ğŸ“ˆ 2025-11-10 CCIåº•èƒŒç¦»ä¹°å…¥ä¿¡å· (3ä¸ª)

  ## äº¤æ˜“æ—¥æœŸ: 2025-11-10
  ## ä¿¡å·æ•°é‡: 3

  ### 1. 000001_SZ å¹³å®‰é“¶è¡Œ
  - ä¿¡å·ç±»å‹: CCIåº•èƒŒç¦»(CCI:-120.5â†’-85.3, 5å¤©)
  - ç½®ä¿¡åº¦: 75.00%
  - å»ºè®®ä»·æ ¼: Â¥12.35
  - èƒŒç¦»ID: 000001_SZ_2025-11-10

  ...
  ```

---

## æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—æ–‡ä»¶å‘½å
- æ ¼å¼ï¼š`logs/executor_YYYYMMDD_HHMMSS.log`
- ç¤ºä¾‹ï¼š`logs/executor_20251110_160000.log`

### æ—¥å¿—å†…å®¹
- æ¯ä¸ªæ­¥éª¤çš„å¼€å§‹/ç»“æŸæ—¶é—´
- å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯
- é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- æ¨é€æˆåŠŸ/å¤±è´¥ç»Ÿè®¡

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
cd logs
dir /O-D  # Windows
# æˆ–ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€

# æœç´¢é”™è¯¯
findstr /i "error" executor_*.log
findstr /i "å¤±è´¥" executor_*.log
```

---

## å¸¸è§é—®é¢˜

### 1. Serveré…±æ¨é€å¤±è´¥

**é—®é¢˜**ï¼šæ—¥å¿—æ˜¾ç¤º"æ¨é€å¤±è´¥"æˆ–"è¿”å›ç é0"

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `config.json` ä¸­çš„SendKeyæ˜¯å¦æ­£ç¡®
2. ç¡®è®¤SendKeyæœªè¿‡æœŸï¼ˆServeré…±å…è´¹ç‰ˆæœ‰æ•ˆæœŸæœ‰é™ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹Serveré…±å®˜ç½‘æ˜¯å¦æœ‰æ¨é€é™åˆ¶

### 2. ä¿¡å·æ–‡ä»¶ä¸ºç©ºæˆ–ä¸å­˜åœ¨

**é—®é¢˜**ï¼šæ­¥éª¤2ç”Ÿæˆçš„ä¿¡å·æ–‡ä»¶ä¸ºç©º

**å¯èƒ½åŸå› **ï¼š
1. ä»Šæ—¥æ— CCIåº•èƒŒç¦»ä¿¡å·ï¼ˆæ­£å¸¸æƒ…å†µï¼‰
2. CCIæ•°æ®åº“æœªæ›´æ–°æˆ–ä¸ºç©º
3. è‚¡ç¥¨æ± æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
4. ç½®ä¿¡åº¦é˜ˆå€¼è®¾ç½®è¿‡é«˜

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `../CCI-Divergence/data/cci_signals.db` æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤CCIæ•°æ®åº“åŒ…å«å†å²èƒŒç¦»æ•°æ®
3. é™ä½ `min_confidence` é˜ˆå€¼æµ‹è¯•
4. æ£€æŸ¥è‚¡ç¥¨æ± æ–‡ä»¶è·¯å¾„å’Œæ ¼å¼

### 3. Kçº¿æ•°æ®æ›´æ–°å¤±è´¥

**é—®é¢˜**ï¼šæ­¥éª¤1æ‰§è¡Œå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. miniQMTæœªå¯åŠ¨æˆ–è¿æ¥å¤±è´¥
2. ç½‘ç»œé—®é¢˜å¯¼è‡´æ•°æ®ä¸‹è½½å¤±è´¥
3. è„šæœ¬è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®è®¤miniQMTå·²å¯åŠ¨å¹¶æ­£å¸¸è¿è¡Œ
2. æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ `stock_data_manager.py` æµ‹è¯•
3. æ£€æŸ¥ `config.json` ä¸­çš„ `script_path` æ˜¯å¦æ­£ç¡®

### 4. å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œ

**é—®é¢˜**ï¼šåˆ°äº†16:00ä»»åŠ¡æ²¡æœ‰è‡ªåŠ¨è¿è¡Œ

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
2. æŸ¥çœ‹ä»»åŠ¡"ä¸Šæ¬¡è¿è¡Œç»“æœ"ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼‰
3. ç¡®è®¤è®¡ç®—æœºåœ¨16:00æ—¶å¤„äºå¼€æœºçŠ¶æ€
4. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«ç¦ç”¨
5. æ‰‹åŠ¨è¿è¡Œä»»åŠ¡æµ‹è¯•

### 5. è‚¡ç¥¨åç§°ä¸æ˜¾ç¤º

**é—®é¢˜**ï¼šæ¨é€æ¶ˆæ¯ä¸­åªæœ‰è‚¡ç¥¨ä»£ç ï¼Œæ²¡æœ‰åç§°

**åŸå› **ï¼š`stock_list.txt` æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `../data/stock_list.txt` æ˜¯å¦å­˜åœ¨
2. å¦‚æœä¸éœ€è¦åç§°ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­è®¾ç½® `include_stock_name: false`
3. æ‰‹åŠ¨åˆ›å»ºè‚¡ç¥¨åç§°ç¼“å­˜æ–‡ä»¶ï¼ˆæ ¼å¼ï¼šä»£ç ,åç§°ï¼‰

---

## æ‰‹åŠ¨æµ‹è¯•

### æµ‹è¯• query å‘½ä»¤ï¼ˆæ¨èï¼‰â­
```bash
cd daily_executor

# æµ‹è¯•å•æ—¥æŸ¥è¯¢
python daily_executor.py query --date 2025-09-04

# æµ‹è¯•æ—¥æœŸèŒƒå›´æŸ¥è¯¢
python daily_executor.py query --date-range 2025-09-01 2025-09-10 --min-confidence 0.7

# æµ‹è¯• CSV è¾“å‡º
python daily_executor.py query --date 2025-09-04 --output csv

# æµ‹è¯• JSON è¾“å‡º
python daily_executor.py query --date 2025-09-04 --output json

# æµ‹è¯•ç‰¹å®šè‚¡ç¥¨æŸ¥è¯¢
python daily_executor.py query --date 2025-09-04 --stock-code 600000_SH
```

### æµ‹è¯• run å‘½ä»¤ï¼ˆå®Œæ•´æµç¨‹ï¼‰
```bash
cd daily_executor

# æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆè·³è¿‡æ•°æ®æ›´æ–°ï¼‰
python daily_executor.py run --skip-step1 --date 2025-11-10

# æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆæŒ‡å®šæ—¥æœŸï¼‰
python daily_executor.py run --date 2025-11-10

# æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆä»Šæ—¥æ•°æ®ï¼‰
python daily_executor.py run
```

### æµ‹è¯•æ¨é€åŠŸèƒ½
```bash
cd daily_executor
python wechat_pusher.py signals/daily_signals.csv
```

---

## é«˜çº§é…ç½®

### è°ƒæ•´æ‰§è¡Œæ—¶é—´

å¦‚æœå‘ç°16:00æ•°æ®è¿˜æœªæ›´æ–°å®Œæˆï¼Œå¯ä»¥è°ƒæ•´ä¸º16:30æˆ–17:00ï¼š

1. åˆ é™¤æ—§ä»»åŠ¡ï¼š`schtasks /Delete /TN "QuantDailyExecutor" /F`
2. ç¼–è¾‘ `setup_task.bat`ï¼Œä¿®æ”¹ `/ST 16:00` ä¸º `/ST 16:30`
3. é‡æ–°è¿è¡Œ `setup_task.bat`

### è‡ªå®šä¹‰è¿‡æ»¤æ¡ä»¶

åœ¨ `daily_executor.py` çš„ `step3_push_to_wechat` æ–¹æ³•ä¸­æ·»åŠ è¿‡æ»¤é€»è¾‘ï¼š

```python
# è¯»å–ä¿¡å·
signals_df = pd.read_csv(signals_file)

# è‡ªå®šä¹‰è¿‡æ»¤ï¼šä¾‹å¦‚åªä¿ç•™ç½®ä¿¡åº¦>0.8çš„ä¿¡å·
signals_df = signals_df[signals_df['confidence'] > 0.8]

# è‡ªå®šä¹‰è¿‡æ»¤ï¼šä¾‹å¦‚æ’é™¤ç‰¹å®šè‚¡ç¥¨
exclude_stocks = ['000001_SZ', '600519_SH']
signals_df = signals_df[~signals_df['stock_code'].isin(exclude_stocks)]

# ä¿å­˜è¿‡æ»¤åçš„ä¿¡å·
signals_df.to_csv(signals_file, index=False)
```

### æ·»åŠ å¤±è´¥é€šçŸ¥

å¦‚æœå¸Œæœ›åœ¨æ‰§è¡Œå¤±è´¥æ—¶ä¹Ÿæ”¶åˆ°æ¨é€é€šçŸ¥ï¼Œå¯ä»¥ä¿®æ”¹ `daily_executor.py`ï¼š

```python
def execute(self):
    try:
        # ... åŸæœ‰ä»£ç  ...
    except Exception as e:
        # å‘é€å¤±è´¥é€šçŸ¥
        self._send_error_notification(str(e))
        raise

def _send_error_notification(self, error_msg: str):
    """å‘é€é”™è¯¯é€šçŸ¥åˆ°Serveré…±"""
    config = self.config['server_sauce']
    for recipient in config['recipients']:
        if not recipient.get('enabled', True):
            continue

        sendkey = recipient['sendkey']
        url = f"https://sctapi.ftqq.com/{sendkey}.send"

        requests.post(url, data={
            'title': 'âŒ è‡ªåŠ¨åŒ–æ¨é€è„šæœ¬æ‰§è¡Œå¤±è´¥',
            'desp': f'é”™è¯¯ä¿¡æ¯ï¼š\n\n```\n{error_msg}\n```'
        })
```

---

## ç»´æŠ¤å»ºè®®

### å®šæœŸæ£€æŸ¥

1. **æ¯å‘¨**ï¼šæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œç¡®è®¤æ‰§è¡Œæ­£å¸¸
2. **æ¯æœˆ**ï¼šæ¸…ç†è¿‡æœŸæ—¥å¿—ï¼ˆè¶…è¿‡30å¤©ï¼‰
3. **æ¯å­£åº¦**ï¼šæ£€æŸ¥Serveré…±SendKeyæ˜¯å¦éœ€è¦ç»­æœŸ

### æ—¥å¿—æ¸…ç†

```bash
# æ‰‹åŠ¨æ¸…ç†30å¤©å‰çš„æ—¥å¿—
forfiles /p "logs" /s /m *.log /d -30 /c "cmd /c del @path"
```

æˆ–æ·»åŠ åˆ° `daily_executor.py` ä¸­è‡ªåŠ¨æ¸…ç†ã€‚

---

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`logs/executor_*.log`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š`config.json`
3. æ‰‹åŠ¨æµ‹è¯•å„ä¸ªæ­¥éª¤
4. æŸ¥çœ‹æœ¬æ–‡æ¡£"å¸¸è§é—®é¢˜"ç« èŠ‚

---

## ç‰ˆæœ¬å†å²

- **v2.0.0** (2025-11-11) â­ é‡å¤§æ›´æ–°
  - âœ… **æ–°å¢æŸ¥è¯¢åŠŸèƒ½**ï¼šæ”¯æŒæŸ¥è¯¢å†å²äº¤æ˜“æ—¥ä¿¡å·ï¼ˆ`query` å‘½ä»¤ï¼‰
  - âœ… **æ¶æ„å‡çº§**ï¼šå¼•å…¥ `QueryEngine` ç»Ÿä¸€æŸ¥è¯¢é€»è¾‘
  - âœ… **å¤šæ ¼å¼è¾“å‡º**ï¼šæ”¯æŒ console/CSV/JSON/å¾®ä¿¡æ¨é€
  - âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå‡ 10x+
  - âœ… **ä»£ç å¤ç”¨**ï¼šæ—¥å¸¸æ‰§è¡Œå’Œå†å²æŸ¥è¯¢å…±äº«æ ¸å¿ƒé€»è¾‘
  - âœ… **æ–°å¢æ¨¡å—**ï¼š
    - `query_engine.py` - æŸ¥è¯¢å¼•æ“
    - `signal_types.py` - ä¿¡å·æ•°æ®ç±»å‹
    - `formatters.py` - è¾“å‡ºæ ¼å¼åŒ–å™¨
    - `add_database_indexes.py` - ç´¢å¼•å·¥å…·

- **v1.0.0** (2025-11-10)
  - åˆå§‹ç‰ˆæœ¬
  - æ”¯æŒKçº¿æ•°æ®è‡ªåŠ¨æ›´æ–°
  - æ”¯æŒCCIåº•èƒŒç¦»ä¿¡å·ç”Ÿæˆ
  - æ”¯æŒServeré…±å¤šäººæ¨é€
  - æ”¯æŒWindowså®šæ—¶ä»»åŠ¡

---

## è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºå†…éƒ¨ä½¿ç”¨å·¥å…·ï¼Œä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚
